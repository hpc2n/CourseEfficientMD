* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v1.8 on Jun, 10. 2017. JOBID=1497111557
* READ PDB, MANIPULATE STRUCTURE IF NEEDED, AND GENERATE TOPOLOGY FILE
*

DIMENS CHSIZE 3000000 MAXRES 3000000

! Read topology and parameter files
stream toppar.str

! Read PROA
open read card unit 10 name 1aki_proa.pdb
read sequence pdb unit 10
generate PROA setup warn first NTER last CTER

open read card unit 10 name 1aki_proa.pdb
read coor pdb  unit 10 resid


! Disulfide bonds
patch disu PROA 6 PROA 127 setup warn
patch disu PROA 30 PROA 115 setup warn
patch disu PROA 64 PROA 80 setup warn
patch disu PROA 76 PROA 94 setup warn

autogenerate angles dihedrals

!Print heavy atoms with unknown coordinates
coor print sele ( .not. INIT ) .and. ( .not. hydrogen ) end

ic param
ic build
prnlev 0
hbuild sele hydr end 
prnlev 5

ENERGY
! check if there are unknown coordinate
define XXX sele .not. INIT show end
if ?nsel .gt. 0 stop ! ABNORMAL TERMINATION: Undefined coordinates

open write card unit 10 name step1_pdbreader.pdb
write coor pdb  unit 10 official

open write card unit 10 name step1_pdbreader.crd
write coor unit 10 card

open write unit 10 card name step1_pdbreader.psf
write psf  unit 10 card

open write unit 10 card name step1_pdbreader.xplor_ext.psf
write psf  xplo unit 10 card

ioformat noext
open write unit 10 card name step1_pdbreader.xplor.psf
write psf  xplo unit 10 card


coor stat sele all end

bomblev -1

coor orient 
coor stat sele all end

! Molecular Volume
calc dcel = 0.5
calc xdim = int ( ( ?xmax - ?xmin + 5.0 ) / @dcel ) + 1
calc ydim = int ( ( ?ymax - ?ymin + 5.0 ) / @dcel ) + 1
calc zdim = int ( ( ?zmax - ?zmin + 5.0 ) / @dcel ) + 1
calc space = @xdim * @ydim * @zdim

scalar wmain = radius
scalar wmain add 1.4    ! use solvent accessible surface for molecular volume
scalar 1 = wmain 
scalar 2 set 6
coor volume hole space @space sele .not. resname TIP3 end
set molvol = ?volume

calc cgtot = int ( ?cgtot )

open write unit 90 card name step1_pdbreader.str
write title unit 90
* set ncharge = @cgtot
* set xmax = ?xmax
* set ymax = ?ymax
* set zmax = ?zmax
* set xmin = ?xmin
* set ymin = ?ymin
* set zmin = ?zmin
* set molvol = @molvol
*

stop
